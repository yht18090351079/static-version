<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>统计分析 - 差旅费用填报系统</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- 导航栏 -->
        <nav class="navbar">
            <div class="nav-content">
                <div class="nav-brand">
                    <h1>差旅费用填报系统</h1>
                </div>
                <div class="nav-menu">
                    <a href="index.html" class="nav-link">费用填报</a>
                    <a href="applicants.html" class="nav-link">申请人管理</a>
                    <a href="statistics.html" class="nav-link active">统计分析</a>
                </div>
            </div>
        </nav>

        <!-- 主内容区域 -->
        <div class="main-container">
            <!-- 页面标题 -->
            <div class="page-header">
                <h2>📊 统计分析</h2>
                <p>差旅费用数据统计与分析</p>
            </div>

            <!-- 数据源状态 -->
            <div class="data-source-status">
                <div class="status-card">
                    <div class="status-icon">📊</div>
                    <div class="status-info">
                        <div class="status-label">数据源状态</div>
                        <div class="status-text" id="dataSourceStatus">正在加载数据...</div>
                    </div>
                </div>
            </div>

            <!-- 筛选控制 -->
            <div class="filter-section">
                <div class="filter-controls">
                    <div class="filter-group">
                        <label for="monthFilter">月份筛选</label>
                        <select id="monthFilter" class="filter-select">
                            <option value="">所有月份</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="departmentFilter">部门筛选</label>
                        <select id="departmentFilter" class="filter-select">
                            <option value="">所有部门</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="typeFilter">差补类型</label>
                        <select id="typeFilter" class="filter-select">
                            <option value="">所有类型</option>
                            <option value="商务">商务</option>
                            <option value="实施">实施</option>
                        </select>
                    </div>
                    <div class="action-group">
                        <button type="button" id="refreshData" class="btn-primary">
                            <span class="btn-icon">🔄</span>
                            刷新数据
                        </button>
                        <button type="button" id="exportData" class="btn-secondary">
                            <span class="btn-icon">📥</span>
                            导出数据
                        </button>
                    </div>
                </div>
            </div>

            <!-- 概览统计卡片 -->
            <div class="overview-section">
                <div class="overview-cards">
                    <div class="overview-card">
                        <div class="card-icon">👥</div>
                        <div class="card-content">
                            <div class="card-title">总申请人数</div>
                            <div class="card-value" id="totalApplicants">0</div>
                        </div>
                    </div>
                    <div class="overview-card">
                        <div class="card-icon">📋</div>
                        <div class="card-content">
                            <div class="card-title">总申请次数</div>
                            <div class="card-value" id="totalApplications">0</div>
                        </div>
                    </div>
                    <div class="overview-card">
                        <div class="card-icon">💰</div>
                        <div class="card-content">
                            <div class="card-title">总费用金额</div>
                            <div class="card-value" id="totalAmount">¥0</div>
                        </div>
                    </div>
                    <div class="overview-card">
                        <div class="card-icon">📅</div>
                        <div class="card-content">
                            <div class="card-title">总出差天数</div>
                            <div class="card-value" id="totalDays">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 图表区域 -->
            <div class="charts-section">
                <div class="charts-grid">
                    <!-- 部门费用统计 -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>部门费用统计</h3>
                            <div class="chart-controls">
                                <button type="button" class="chart-type-btn active" data-chart="departmentChart" data-type="bar">柱状图</button>
                                <button type="button" class="chart-type-btn" data-chart="departmentChart" data-type="pie">饼图</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="departmentChart"></canvas>
                        </div>
                    </div>

                    <!-- 月份趋势统计 -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>月份趋势统计</h3>
                            <div class="chart-controls">
                                <button type="button" class="chart-type-btn active" data-chart="monthChart" data-type="line">折线图</button>
                                <button type="button" class="chart-type-btn" data-chart="monthChart" data-type="bar">柱状图</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="monthChart"></canvas>
                        </div>
                    </div>

                    <!-- 差补类型统计 -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>差补类型统计</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="typeChart"></canvas>
                        </div>
                    </div>

                    <!-- 人员排行榜 -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>人员费用排行</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="personChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 详细数据表格 -->
            <div class="table-section">
                <div class="table-header">
                    <h3>详细数据表格</h3>
                    <div class="table-controls">
                        <div class="pagination-info">
                            <span id="paginationInfo">显示 0 - 0 条，共 0 条记录</span>
                        </div>
                        <div class="pagination-controls">
                            <button type="button" id="prevPage" class="btn-pagination" disabled>上一页</button>
                            <span id="currentPage">1</span> / <span id="totalPages">1</span>
                            <button type="button" id="nextPage" class="btn-pagination" disabled>下一页</button>
                        </div>
                    </div>
                </div>
                <div class="table-container">
                    <table id="dataTable" class="data-table">
                        <thead>
                            <tr>
                                <th>申请人</th>
                                <th>部门</th>
                                <th>申请月份</th>
                                <th>出差日期</th>
                                <th>差补类型</th>
                                <th>差补天数</th>
                                <th>差补金额</th>
                                <th>餐补天数</th>
                                <th>餐补金额</th>
                                <th>合计金额</th>
                                <th>填报时间</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- 数据行将在这里动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载飞书API模块 -->
    <script src="js/feishu-api-proxy.js?v=3"></script>
    <!-- 加载统计分析脚本 -->
    <script src="js/statistics.js?v=1"></script>
</body>
</html>
